@inherits LayoutComponentBase

<CascadingValue Value="this">
    <div class="tab-view">
        <div class="tab-headers">
            @foreach (var tab in Tabs)
            {
                <button 
                    class="tab-button @(tab == ActiveTab ? "selected" : "")"
                    @onclick="@(() => SetActive(tab))">
                    @tab.Header
                </button>
            }
        </div>

        <div class="tab-content">
            @ActiveTab?.Content
        </div>
    </div>

    @ChildContent
</CascadingValue>

@code {
    [Parameter]
    public RenderFragment ChildContent { get; set; } = null!;

    [Parameter]
    public Action<Tab>? TabChanged { get; set; }
    
    internal List<Tab> Tabs { get; } = [];
    internal Tab? ActiveTab { get; private set; }

    internal void RegisterTab(Tab tab)
    {
        Tabs.Add(tab);
        ActiveTab ??= tab;
        
        StateHasChanged();
    }

    private void SetActive(Tab tab)
    {
        ActiveTab = tab;
        TabChanged?.Invoke(tab);
    }

    public class Tab
    {
        public string Header { get; set; } = string.Empty;
        public RenderFragment Content { get; set; } = null!;
    }
}